(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};window.MyTree=function(){function b(b){this.update=a(this.update,this),this.adjustTree=a(this.adjustTree,this);var c,d=this;this.root=b,c=[20,120,20,120],this.w=1280-c[1]-c[3],this.h=800-c[0]-c[2],this.i=0,this.nodeWidth=100,this.nodeSeparation=10,this.nodeSeparationRel=(this.nodeSeparation+this.nodeWidth)/this.nodeWidth,this.tree=d3.layout.tree().nodeSize([this.nodeWidth,20]).separation(function(){return d.nodeSeparationRel}),this.diagonal=function(a){return"M"+a.source.x+","+a.source.y+"V"+(a.source.y+(a.target.y-a.source.y)/2)+"H"+a.target.x+"V"+a.target.y},$("svg").html(""),this.vis=d3.select("svg").attr("width",this.w+c[1]+c[3]).attr("height",this.h+c[0]+c[2]).append("svg:g").attr("transform","translate("+(this.w/2+c[1])+","+c[0]+")"),this.root.x0=0,this.root.y0=0,this.update(this.root)}return b.prototype.adjustTree=function(a){var b,c,d,e=this;return b=function(a){return a.children?(a.x=0,a.children.forEach(function(b){return a.x+=b.x}),a.x/=a.children.length):void 0},d=function(a){var c,d;return d=function(){var b;return b=-e.w/2,a.forEach(function(a){a.x<b?(a.x=b,b+=e.nodeWidth+e.nodeSeparation):b=a.x+e.nodeWidth+e.nodeSeparation})},c=function(){var b;return b=e.w/2-e.nodeWidth,a.forEach(function(a){a.x>b?(a.x=b,b-=e.nodeWidth+e.nodeSeparation):b=a.x-(e.nodeWidth+e.nodeSeparation)})},a=a.sort(function(a,b){return a.x-b.x}),a.forEach(b),a=a.sort(function(a,b){return a.parent===b.parent?a.x-b.x:a.parent.x-b.parent.x}),d(),a=a.reverse(),c(),a=a.reverse(),d()},c=[],a.forEach(function(a){var b;return null==c[b=a.depth]&&(c[b]=[]),c[a.depth].push(a)}),c.reverse().forEach(function(a){return d(a)})},b.prototype.update=function(a){var b,c,d,e,f,g,h,i=this;b=d3.event&&d3.event.altKey?5e3:500,h=this.tree.nodes(this.root).reverse(),h.forEach(function(a){a.y=100*a.depth}),d=this.vis.selectAll("g.node").data(h,function(a){return a.id||(a.id=++i.i)}),this.adjustTree(h),e=d.enter().append("svg:g").attr("class","node").attr("transform",function(){return"translate("+a.x0+","+a.y0+")"}).on("click",function(a){i.toggle(a),i.update(a)}),e.append("svg:rect").attr("width",1).attr("height",1).style("fill",function(a){return a._children?"lightsteelblue":"#fff"}),e.append("svg:text").attr("y",10).attr("dy",".35em").attr("text-anchor",function(){return"middle"}).text(function(a){return a.name}).style("fill-opacity",1e-6),g=d.transition().duration(b).attr("transform",function(a){return"translate("+a.x+","+a.y+")"}),g.select("rect").attr("width",100).attr("height",20).attr("x",-50).style("fill",function(a){return a._children?"lightsteelblue":"#fff"}),g.select("text").style("fill-opacity",1),f=d.exit().transition().duration(b).attr("transform",function(){return"translate("+a.x+","+a.y+")"}).remove(),f.select("rect").attr("width",1).attr("height",1),f.select("text").style("fill-opacity",1e-6),c=this.vis.selectAll("path.link").data(this.tree.links(h),function(a){return a.target.id}),c.enter().insert("svg:path","g").attr("class","link").attr("d",function(){var b;return b={x:a.x0,y:a.y0},i.diagonal({source:b,target:b})}).transition().duration(b).attr("d",this.diagonal),c.transition().duration(b).attr("d",this.diagonal),c.exit().transition().duration(b).attr("d",function(){var b;return b={x:a.x,y:a.y},i.diagonal({source:b,target:b})}).remove(),h.forEach(function(a){a.x0=a.x,a.y0=a.y})},b.prototype.toggle=function(a){a.children?(a._children=a.children,a.children=null):(a.children=a._children,a._children=null)},b}()}).call(this),function(){var a,b,c;a=jQuery,b=function(a){return Math.floor(Math.random()*a)},c=function(a){var c,d;return d=0,(c=function(a){var e,f,g,h;if(e={name:"Test String "+d++,_children:null},1!==a&&b(2)>=1)for(e._children=[],f=g=0,h=b(11);h>=0?h>=g:g>=h;f=h>=0?++g:--g)e._children[f]=c(a-1);return e})(a)},a(function(){window.current_tree=c(4),a("#treejson").val(JSON.stringify(current_tree,null,2)),a("#apply").on("click",function(){window.current_tree=jQuery.parseJSON(a("#treejson").val()),window.treee=new MyTree(current_tree)}),window.treee=new MyTree(current_tree)})}.call(this);